<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to create a new task &mdash; AI-Challenge 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="AI-Challenge 0.1 documentation" href="index.html" />
    <link rel="prev" title="Welcome to AI-Challenge’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to AI-Challenge’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">AI-Challenge 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-create-a-new-task">
<h1>How to create a new task<a class="headerlink" href="#how-to-create-a-new-task" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-your-task-step-by-step">
<h2>Creating your task step-by-step<a class="headerlink" href="#creating-your-task-step-by-step" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need to do, is creating a python file (it&#8217;s nicer if you create it under the tasks directory) and import the necessary Task class and related tools::</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">core.task</span> <span class="kn">import</span> <span class="n">Task</span><span class="p">,</span> <span class="n">on_start</span><span class="p">,</span> <span class="n">on_message</span><span class="p">,</span> <span class="n">on_sequence</span><span class="p">,</span>\
    <span class="n">on_state_changed</span><span class="p">,</span> <span class="n">on_timeout</span><span class="p">,</span> <span class="n">on_output_message</span><span class="p">,</span> <span class="n">on_init</span>
</pre></div>
</div>
<p>In order to define a task, the first thing you need to do is subclassing the Task class as follows. You can omit the world parameter if it doesn&#8217;t run on any world.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">world</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyTask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">env</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, you will need to define how it will react to a set of events (e.g. when the task  is starting, when the learner has produced some expected message, etc.). This is achieved by defining event handlers which have this general form::</p>
<div class="highlight-python"><div class="highlight"><pre>@on_&lt;type-of-event&gt;(&lt;some-optional-parameters&gt;)
def on_my_event(self, event):
    ...code...
</pre></div>
</div>
<p>There are a number of events that have been contemplated, which are detailed below. Also, the reactions to these event can include calling primitives to affect the environment actions, like setting the output message or rewarding the agent.</p>
<p>When you are done with writing your task, you can instantiate it from the main file and send it to the scheduler  so it will be run with the other tasks (see points 2 and 3 in the Summary).</p>
</div>
<div class="section" id="event-handlers">
<h2>Event Handlers<a class="headerlink" href="#event-handlers" title="Permalink to this headline">¶</a></h2>
<p>In order to create an event handler, you need to the define a method (like on_my_event above) annotated with the type of event that you want to catch. These are the possible annotations you can use:</p>
<ul class="simple">
<li>on_init: Fires when a task is about to be run, but it hasn&#8217;t started yet. It serves for initialization purposes.</li>
<li>on_start: Fires when a task actually starts.</li>
<li>on_message: Fires whenever the agent sends a message. It optionally takes a regular expression to match only a specified set of messages. The event object contains a &#8220;message&#8221; field, containing the message that has been received. Finally, two other helper methods have been introduced in the event object. The first, is_message, takes a string and checks whether the last part of the message exactly matches this string (see RepeatingCharTask for an example). The second, get_match, returns the part of the message that has been matched against the regular expression that parametrizes on_message. Optionally, if this regular expression contains groups (parentheses-demarcated chunks), you can give the group number as an argument to retrieve any of these sub-matches (see on_pick_up in the grid world for an example).</li>
<li>on_sequence: Like on_message, but operates on sequences of bits (actually a string of 1s and 0s). The event object contains a &#8220;sequence&#8221; field, containing the sequence that has been received so far.</li>
<li>on_output_message: Same as on_message, but it matches against what the environment has said.</li>
<li>on_output_sequence: Same as on_sequence, but it matches against what the environment has said.</li>
<li>on_state_changed: Every task and every world implicitly have a state object where you can store any properties you want (by doing self.state.my_variable_state = some_value). You can catch whenever the state object gets modified by annotating your handler with on_state_changed.  This takes as a parameter either a one-argument or a two-argument function (depending on whether there is a world state in conjunction with the task state or not). In python, anonymous functions can be defined, for example, like lambda ts: ts.my_variable_state == 10 for the one argument case or lambda ws, ts: ts.my_variable_state == ws.my_world_variable_state  for the two argument case. In the one argument case, the function is fed the state object of the task. In the two argument case, the function is fed the world state object and the task state object. See the MovingTask for an example, it&#8217;s easier than it looks.</li>
<li>on_timeout: Gets triggered when we reached the maximum amount of time steps.</li>
<li>on_world_init: Like on_init, but when a world is being initialized.</li>
<li>on_world_start: Like on_start, but when a world is being started.</li>
</ul>
</div>
<div class="section" id="defining-event-handlers-at-runtime">
<h2>Defining Event Handlers at &#8220;runtime&#8221;<a class="headerlink" href="#defining-event-handlers-at-runtime" title="Permalink to this headline">¶</a></h2>
<p>Say that you are in the middle of your start (say, on the start event) and you want to add a new event handler on the fly. You can do this, by inserting a code snippet just as the following (notice that you can define a function within a function)::</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@on_start</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">my_task_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
         <span class="o">...</span> <span class="o">&lt;</span><span class="n">something</span> <span class="n">something</span><span class="o">&gt;</span> <span class="o">...</span>
         <span class="k">def</span> <span class="nf">my_success_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">set_reward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">on_</span><span class="o">&lt;</span><span class="n">event</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_success_handler</span><span class="p">))</span>
</pre></div>
</div>
<p>This also works if <cite>my_success_handler</cite> is an instance method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@on_start</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">my_task_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
         <span class="o">...</span> <span class="o">&lt;</span><span class="n">something</span> <span class="n">something</span><span class="o">&gt;</span> <span class="o">...</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">on_</span><span class="o">&lt;</span><span class="n">event</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">my_success_handler</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">my_success_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">set_reward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="action-primitives">
<h2>Action Primitives<a class="headerlink" href="#action-primitives" title="Permalink to this headline">¶</a></h2>
<p>Here are the few things you can do to affect the environment behavior. The Task and World classes have the following inherited methods:</p>
<ul class="simple">
<li><tt class="code docutils literal"><span class="pre">set_message(message,</span> <span class="pre">priority=0)</span></tt>: Writes into the output buffer a message with the given priority only if there is no other message being sent with a higher priority.</li>
<li><tt class="code docutils literal"><span class="pre">set_reward(reward,</span> <span class="pre">message='',</span> <span class="pre">priority=0)</span></tt>:  Rewards the learner and ends the task. You can also send a finalization message with the given priority (the priority only applies to the message, not rewards).</li>
<li><tt class="code docutils literal"><span class="pre">ignore_last_char()</span></tt>: removes (or rather, masks with silence) the last character that has been received from the learner. This does not have an effect on already-fired MessageReceived events. Useful if you want to ignore the learner until some later instant.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How to create a new task</a><ul>
<li><a class="reference internal" href="#creating-your-task-step-by-step">Creating your task step-by-step</a></li>
<li><a class="reference internal" href="#event-handlers">Event Handlers</a></li>
<li><a class="reference internal" href="#defining-event-handlers-at-runtime">Defining Event Handlers at &#8220;runtime&#8221;</a></li>
<li><a class="reference internal" href="#action-primitives">Action Primitives</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to AI-Challenge&#8217;s documentation!</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/creating_tasks.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to AI-Challenge’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">AI-Challenge 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Facebook.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>